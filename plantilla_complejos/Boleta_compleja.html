<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura <?= transaccion_numero ?></title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Roboto', Arial, sans-serif; line-height: 1.2; margin: 0; padding: 0; font-size: 11px; color: #000; }
      .header, .header-space { height: 95px; }
      .footer, .footer-space { height: 95px; }
      .header { position: fixed; top: 0; left: 0; width: 100%; background-color: #fff; padding: 10px; box-sizing: border-box; z-index: 999; }
      .footer { position: fixed; bottom: 0; left: 0; width: 100%; padding: 10px; background-color: #fff; font-size: 8px; text-align: center; box-sizing: border-box; }
      #qr-fixed { position: fixed; bottom: 0mm; left: 0mm; width: 85px; height: 85px; z-index: 1000; }
      table { width: 100%; border-collapse: collapse; margin: 0; padding: 0; }
      .container { width: 100%; max-width: 800px; margin: 0 auto; padding: 10px; box-sizing: border-box; }
      .header-grid { display: grid; grid-template-columns: 200px 1fr 180px; gap: 10px; align-items: start; }
      .company-info { text-align: center; font-size: 10px; }
      .document-info { text-align: center; border: 2px solid #000; border-radius: 10px; padding: 5px; font-weight: bold; }
      .document-title { font-size: 11px; font-weight: bold; margin-bottom: 5px; }
      .document-number { font-size: 14px; font-weight: bold; color: #ff0000; }
      .bordered-section { border: 1px solid #000; margin: 10px 0; border-radius: 10px; padding: 5px; }
      .transporter-grid { display: grid; grid-template-columns: 65% 35%; gap: 4%; padding: 7px; }
      .info-item { display: flex; flex-wrap: wrap; margin-bottom: 3px; align-items: baseline; }
      .info-label { font-weight: bold; margin-right: 3px; margin-bottom: 5px; width: 100px; text-align: left; }
      /*table#items-table { width: 100%; margin: 10px 0; border-collapse: collapse; border-spacing: 0; border: 0.5px solid #333333; overflow: hidden; }
      table#items-table th, table#items-table td { font-size: 11px; border: 0.5px solid #333333; padding: 3px 5px; }
      table#items-table th { background-color: #e0e0e0; color: black; font-weight: bold; text-align: center; }*/
      .tabla-montos { width: 34%; border-collapse: separate; border-spacing: 0; border: 1.5px solid #000; border-radius: 8px; overflow: hidden; font-size: 10px; }
      .tabla-montos td { border: none; padding: 3px; vertical-align: middle; }
      .tabla-montos td + td { border-left: 1.5px solid #000; }
      .tabla-montos tr + tr td { border-top: 1.5px solid #000; }
      .resaltado { background-color: #e0e0e0; color: black; font-weight: bold; }
      #tabla_cuotas_container { display: flex; justify-content: center; width: 100%; margin-top: 20px; }
      #tabla_cuotas { width: 40%; border-collapse: separate; border-spacing: 0; border: 1px solid black; border-radius: 8px; overflow: hidden; }
      #tabla_cuotas th, #tabla_cuotas td { border: none; text-align: center; padding: 5px;font-size:10px }
      #tabla_cuotas th + th, #tabla_cuotas td + td { border-left: 1px solid black; }
      #tabla_cuotas tr + tr td { border-top: 1px solid black; }
      #tabla_cuotas th { background-color: #e0e0e0; font-weight: bold; border-bottom: 1px solid black;}
      .avoid-page-break { break-inside: avoid; page-break-inside: avoid; }
/* ================================================= */
/* === ESTILOS PARA LA TABLA DE DETALLES (ITEMS) === */
/* ================================================= */

/* Estilos generales para toda la tabla */
table#items-table { 
  width: 100%; 
  margin: 10px 0; 
  border-collapse: collapse; 
  border-spacing: 0; 
  border: 0.5px solid #333333; 
  overflow: hidden; 
}

/* Estilos generales para todas las celdas (encabezado y datos) */
table#items-table th, table#items-table td { 
  font-size: 10px; 
  border: 0.5px solid #333333; 
  padding: 4px 5px; /* Un poco más de padding vertical */
}

/* Estilos generales solo para los encabezados (th) */
table#items-table th { 
  background-color: #e0e0e0; 
  color: black; 
  font-weight: bold; 
  text-align: center; 
}

/* --- ESTILOS ESPECÍFICOS POR COLUMNA --- */
/* Usamos th y td juntos para que el encabezado y el contenido siempre tengan la misma alineación y ancho */

/* Columna 1: ITEM */
table#items-table th:nth-child(1),
table#items-table td:nth-child(1) {
  text-align: center;
  width: 5%;
}

/* Columna 2: CÓDIGO */
table#items-table th:nth-child(2),
table#items-table td:nth-child(2) {
  text-align: center;
  width: 9%;
}

/* Columna 3: DESCRIPCION */
table#items-table th:nth-child(3),
table#items-table td:nth-child(3) {
  width: 39%;
}
table#items-table td:nth-child(3) {
  text-align: left;
}



/* Columna 4: CANTIDAD. */
table#items-table th:nth-child(4),
table#items-table td:nth-child(4) {
  text-align: center;
  width: 8%;
}

/* Columna 5: UM  */
table#items-table th:nth-child(5),
table#items-table td:nth-child(5) {
  text-align: center;
  width: 6%;
}

/* Columna 6: VALOR VENTA (alineado a la derecha) */
table#items-table th:nth-child(6),
table#items-table td:nth-child(6) {
  width: 12%;
}
table#items-table td:nth-child(6) {
  text-align: right;
}


/* Columna 7: DESCUENTO (alineado a la derecha) */
table#items-table th:nth-child(7),
table#items-table td:nth-child(7) {
  width: 9%;
}

table#items-table td:nth-child(7) {
  text-align: right;
}

/* Columna 8: TOTAL ITEM (alineado a la derecha) */
table#items-table th:nth-child(8),
table#items-table td:nth-child(8) {
  width: 12%;
}
table#items-table td:nth-child(8) {
  text-align: right;
}




      @media print {
        @page { size: A4; margin: 1cm; }
        .section-title, #items-table th, .resaltado { background-color: #e0e0e0 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      }
    </style>
</head>
<body>

    <div class="header">
      <div class="header-grid">
        <img src="" alt="Logo" id="logo" style="width: 120px; height: auto;">
        <div class="company-info">
          <div style="font-size: 13px; font-weight: bold;"><?= cp_tit ?></div>
          <div><?= cp_dir1 ?></div>
          <div><?= cp_dir2 ?></div>
          <div><?= cp_dir3 ?></div>
          <div><?= cp_dir4 ?></div>
          <div><?= cp_dir5  ?></div>
  
        </div>
        <div class="document-info">
          <div style="text-align: center; margin-bottom: 5px; font-size: 11px;">RUC: <?= negocio_ruc ?></div>
          <div class="document-title">FACTURA ELECTRONICA</div>
          <div class="document-number"><?= transaccion_numero ?></div>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>Representación impresa de la FACTURA ELECTRÓNICA</p>
      <p>Autorizado mediante resolucion Nro. 0340050010017/SUNAT</p>
    </div>

    <table>
      <thead>
        <tr><td><div class="header-space"></div></td></tr>
      </thead>
      <tbody>
        <tr><td> 
          <div class="container">
            <div class="bordered-section">
              <div class="transporter-grid">
                <div class="info-item"><span class="info-label">Cliente:</span><span><?= anexo_nombre ?></span></div>
                <div class="info-item"><span class="info-label">Fecha Emisión:</span><span><?= fecha_emi ?></span></div>
                <div class="info-item"><span class="info-label"><?= anexo_documento_nombre ?>:</span><span><?= anexo_ruc ?></span></div>
                <div class="info-item"><span class="info-label">Fecha Venc.:</span><span><?= fecha_ven ?></span></div>
                <div class="info-item"><span class="info-label">Dirección:</span><span><?= anexo_dir ?></span></div>
                <div class="info-item"><span class="info-label">Forma de pago:</span><span><?= forma_pago ?></span></div>
              </div>
            </div>
            <div class="bordered-section">
              <div class="transporter-grid">
                <div class="info-item"><span class="info-label">Contrato/OC:</span><span><?= referencia ?></span></div>
                <div class="info-item"><span class="info-label">Guia Remisión:</span><span><?= doc_relacionado01 ?></span></div>
                <div class="info-item"><span class="info-label">Observación:</span><span><?= observacion01 ?></span></div>
                <div class="info-item"><span class="info-label">Moneda:</span><span><?= moneda_texto ?></span></div>
              </div>
            </div>
            <table id="items-table">
              <thead>
                <tr>
                  <th>ITEM</th>
                  <th>CÓDIGO</th>
                  <th>DESCRIPCIÓN</th>
                  <th>CANTIDAD</th>
                  <th>UM</th>
                  <th>VALOR UNITARIO</th>
                  <th>DESCUENTO</th>
                  <th>PRECIO TOTAL</th>
                  </tr>
              </thead>
              <tbody >
                <?!= filas_detalle ?>
              </tbody>
            </table>
            <div class="avoid-page-break" style="display: flex; justify-content: space-between; margin-top: 20px; align-items: flex-start;">
              <div style="width: 65%; box-sizing: border-box; min-height: 90px; display: flex; flex-direction: column; justify-content: space-between;">
                <strong style="margin-bottom:20px"><?= tot_letras_appscript ?></strong>
                <? if (mostrarDetraccion === "true") { ?>
                  <p><strong>Nro. Cta. Banco de la Nación:</strong> <span><?= nro_cta ?></span></p>
                  <p><strong>Porcentaje de detracción:</strong> <span><?= porc_det ?></span></p>
                  <p><strong>Monto detracción:</strong> <span><?= monto_detSol ?></span></p>
                <? } ?>
              </div>
              <table class="tabla-montos" style="width: 34%;">
                <tbody>
                  <tr><td class="resaltado">SUBTOTAL VENTA</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= subtotal_ventas ?></td></tr>
                  <tr><td class="resaltado">ANTICIPOS</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= anticipos ?></td></tr>
                  <tr><td class="resaltado">DESCUENTOS GLOB.</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= descuentos ?></td></tr>
                  <tr><td class="resaltado">VALOR DE VENTA</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= valor_venta ?></td></tr>
                  <tr><td class="resaltado">ISC</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= isc ?></td></tr>
                  <tr><td class="resaltado">IGV(18%)</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= igv ?></td></tr>
                  <tr><td class="resaltado">ICBPER</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= icbper ?></td></tr>
                  <tr><td class="resaltado">OTROS CARGOS</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= otros_cargos ?></td></tr>
                  <tr><td class="resaltado">OTROS TRIBUTOS</td><td style="text-align: center;"><?= moneda_simbolo ?></td><td style="text-align: right;"><?= otros_tributos ?></td></tr>
                  <tr><td class="resaltado"><strong>TOTAL VENTA</strong></td><td style="text-align: center;"><strong><?= moneda_simbolo ?></strong></td><td style="text-align: right;"><strong><?= total_venta ?></strong></td></tr>
                </tbody>
              </table>
            </div>
            <? if (forma_pago_simple !== "Contado") { ?>
              <div id="tabla_cuotas_container" style="display: flex; justify-content: center; width: 100%; margin-top: 20px;">
                <table id="tabla_cuotas">
                    <thead><tr><th>Cuota</th><th>Fecha de pago.</th><th>Monto</th></tr></thead>
                    <tbody id="filas_cuotas"><?!= filas_cuotas ?></tbody>
                </table>
              </div>
            <? } ?>
          </div>
        </td></tr>
      </tbody>
      <tfoot>
        <tr><td><div class="footer-space"></div></td></tr>
      </tfoot>
    </table>

   <? if ( imagen_qr_respuesta && imagen_qr_respuesta !== "") { ?>
  <img id="qr-fixed" src="<?= imagen_qr_respuesta ?>" alt="Código QR">
<? } ?>

   <script>
     // SCRIPT PARA EL LOGO
     var imagen_logo = "<?= logo ?>";
     if (imagen_logo) {
         document.getElementById("logo").src = imagen_logo;
     }
   </script>
   <script>
     // SCRIPT PARA EL QR
     var qrBase64 = "<?= imagen_qr_respuesta ?>";
     if (qrBase64) {
         document.getElementById("qr-fixed").src = qrBase64;
     }
   </script>
</body>
</html>